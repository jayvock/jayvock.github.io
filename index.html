<!DOCTYPE html>
<html lang="en">

<head>
	<title>Test for Ollie</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <link rel="stylesheet" type="text/css" href="StyleSheet.css" >

</head>

<body>
    <div class="b">
        <input class="button" type="button" id="coup" value="coup.mp4" playsinline onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/coup.mp4', fbxLabel, 544, 960);">
        <input class="button" type="button" id="courage" value="courage!.mp4" playsinline onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/courage!.mp4', fbxLabel, 1080, 720);">
        <input class="button" type="button" id="daliaing" value="daliaing.jpg" onclick="video.pause(); video.currentTime = 0; loadTexture('textures/daliaing.jpg', fbxLabel);">
        <input class="button" type="button" id="dreamteam7" value="dream team 7.mp4" playsinline onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/dream team 7.mp4', fbxLabel, 1080, 720);">
        <input class="button" type="button" id="drive" value="drive.mp4" onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/drive.mp4', fbxLabel, 720, 720);">
        <input class="button" type="button" id="elegy" value="elegy.mp4" onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/elegy.mp4', fbxLabel, 480, 272);">
        <input class="button" type="button" id="emancipation" value="emancipation.mp4" onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/emancipation.mp4', fbxLabel, 640, 360);">
        <input class="button" type="button" id="forever" value="forever.mp4" onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/forever.mp4', fbxLabel, 1280, 720);">
        <input class="button" type="button" id="forgiveness" value="forgiveness.mp4" onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/forgiveness.mp4', fbxLabel, 1080, 720);">
        <input class="button" type="button" id="gundam" value="G Gundam - Shining Finger Sword.mp4" onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/G Gundam - Shining Finger Sword.mp4', fbxLabel, 480, 360);">
        <input class="button" type="button" id="gerrouttaere" value="gerrouttaere.mp4" onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/gerrouttaere.mp4', fbxLabel, 1280, 720);">
        <input class="button" type="button" id="girl" value="girl.mp4" onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/girl.mp4', fbxLabel, 352, 288);">
        <input class="button" type="button" id="hanzobaby" value="hanzo_baby.mp4" onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/hanzo_baby.mp4', fbxLabel, 404, 720);">
        <input class="button" type="button" id="happyplace" value="happy place.mp4" onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/happy place.mp4', fbxLabel, 1280, 720);">
        <input class="button" type="button" id="hypnopower" value="hypno power!.mp4" onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/hypno power!.mp4', fbxLabel, 352, 288);">
        <input class="button" type="button" id="iamchad" value="i am chad.mp4" onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/i am chad.mp4', fbxLabel, 1280, 720);">
        <input class="button" type="button" id="iarisebecause" value="i arise because.jpg" onclick="video.pause(); video.currentTime = 0; loadTexture('textures/i arise because.jpg', fbxLabel);">
        <input class="button" type="button" id="iseemorenow" value="i see more now.mp4" onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/i see more now.mp4', fbxLabel, 1080, 720);">
        <input class="button" type="button" id="iwont" value="i wont.mp4" onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/i wont.mp4', fbxLabel, 640, 360);">
        <input class="button" type="button" id="ily" value="ily.mp4" onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/ily.mp4', fbxLabel, 480, 848);">
        <input class="button" type="button" id="infinityandbeyond" value="infinity and beyond.mp4" onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/infinity and beyond.mp4', fbxLabel, 1280, 720);">
        <input class="button" type="button" id="manifesto" value="manifesto.mp4" onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/manifesto.mp4', fbxLabel, 1080, 720);">
        <input class="button" type="button" id="standyourground" value="stand your ground.mp4" onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/stand your ground.mp4', fbxLabel, 352, 288);">
        <input class="button" type="button" id="studs" value="studs.mp4" onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/studs.mp4', fbxLabel, 1280, 720);">
        <input class="button" type="button" id="zombiewalk" value="zombie walk.mp4" onclick="video.pause(); video.currentTime = 0; loadVideo('textures/videos/zombie walk.mp4', fbxLabel, 404, 720);">
       

    </div>
	<script src="js/three.js"></script>
	<script src="js/inflate.min.js"></script>
	<script src="js/FBXLoader.js"></script>
	<script src="js/TGALoader.js"></script>
	<script src="js/OrbitControls.js"></script>
	<script src="js/Detector.js"></script>
    <script src="node_modules/iphone-inline-video/dist/iphone-inline-video.js"></script>
   
    <script>
    document.addEventListener('touchmove',
        function(e) {
            e.preventDefault();
        }, {passive:false});
    </script>
    
	<script>

		if (!Detector.webgl) Detector.addGetWebGLMessage();

		var container, controls;
		var camera, scene, renderer, light;
		var fbxLabel;
		var fbxBottle;
		var fbxLoader = new THREE.FBXLoader();
		var textureLoader = new THREE.TextureLoader();
		var particleMaterial;

		var raycaster;
		var mouse;

		var video, videoImage, videoImageContext, videoTexture;


		init();
		animate();

		function init() {

		   container = document.createElement('div');
		   document.body.appendChild(container);

		    camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 15000);
		    camera.position.set(100, 800, 300);

		    controls = new THREE.OrbitControls(camera);
		    controls.target.set(0, 600, 0);
		    controls.update();

		    scene = new THREE.Scene();
		    scene.background = new THREE.Color(000000);
		    // scene.fog = new THREE.Fog( 0xa0a0a0, 200, 1000 );

		    var ambient = new THREE.AmbientLight(0x101030);
		    scene.add(ambient);

		    light = new THREE.HemisphereLight(0xffffff, 0x444444);
		    light.position.set(0, 200, 0);
		    scene.add(light);

		    light = new THREE.DirectionalLight(0xffffff);
		    light.position.set(0, 200, 100);
		    light.castShadow = true;
		    light.shadow.camera.top = 180;
		    light.shadow.camera.bottom = -100;
		    light.shadow.camera.left = -120;
		    light.shadow.camera.right = 120;
		    scene.add(light);

		    // ground
		    /* var mesh = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2000, 2000 ), new THREE.MeshPhongMaterial( { color: 0x999999, depthWrite: false } ) );
			mesh.rotation.x = - Math.PI / 2;
			mesh.receiveShadow = true;
			scene.add( mesh );

			var grid = new THREE.GridHelper( 2000, 20, 0x000000, 0x000000 );
			grid.material.opacity = 0.2;
			grid.material.transparent = true;
			scene.add( grid ); */

		    renderer = new THREE.WebGLRenderer({ antialias: true });
		    renderer.setPixelRatio(window.devicePixelRatio);
		    renderer.setSize(window.innerWidth, window.innerHeight);
		    renderer.shadowMap.enabled = true;
		    container.appendChild(renderer.domElement);
		    renderer.setClearColor(0xffffff, 0);

		    raycaster = new THREE.Raycaster();
		    mouse = new THREE.Vector2();

		    video = document.createElement('video');
		  //  var button = document.getElementById("therapyx");
		  //  button.addEventListener("click", onClick)


		    // load models
		    fbxLoader.load('BottleLabelASCII.FBX', function (label) {

		        fbxLabel = label;
		        loadTexture('textures/final destination xp.png', fbxLabel)

		        label.scale.set(0.01, 0.01, 0.01);
		        label.rotation.x = -Math.PI / 2;
		        label.rotation.z = 90;
		        label.position.set(0, 500, 0);

		        scene.add(label);

		    });

		    fbxLoader.load('PillBottleASCII.FBX', function (bottle) {

		        fbxBottle = bottle;

		        bottle.scale.set(0.1, 0.1, 0.1);
		        bottle.rotation.x = -Math.PI / 2;
		        bottle.rotation.z = 90;
		        bottle.position.set(0, 500, 0);

		        scene.add(bottle);
		    });

		    
		};


		// load texture
		function loadTexture(path, object) {
			var textureLoader = new THREE.TextureLoader(); // new line
			textureLoader.setCrossOrigin("anonymous"); // new line
			textureLoader.load(path, function (texture) {
			    object.traverse(function (child) {
			        if (child instanceof THREE.Mesh) {
			            child.material.map = texture;
			            child.material.needsUpdate = true;
			        }
			    });
			}
			);   
			
		}
        // load videos
		function loadVideo(src, object, width, height) {
		    // create the video element
		    document.querySelector('video');
		    enableInlineVideo(video);

		    video.pause();
		    video.currentTime = 0;
		    video.src = src;
		    video.setAttribute('webkit-playsinline', '');
            video.loop = true;
		    video.load(); // must call after setting/changing source
		    video.play();
		    videoImage = document.createElement('canvas');
		    videoImage.width = width;
		    videoImage.height = height;
		    


		    videoImageContext = videoImage.getContext('2d');
		    // background color if no video present
		    videoImageContext.fillStyle = '#000000';
		    videoImageContext.fillRect(0, 0, videoImage.width, videoImage.height);

		    videoTexture = new THREE.Texture(videoImage);
		    videoTexture.minFilter = THREE.LinearFilter;
		    videoTexture.magFilter = THREE.LinearFilter;

		    var movieMaterial = new THREE.MeshBasicMaterial({ map: videoTexture, overdraw: true, side: THREE.DoubleSide });
		    object.traverse(function (child) {
		        if (child instanceof THREE.Mesh) {
		            child.material.map = videoTexture;
		            child.material.needsUpdate = true;
		        }
		    })
		}


		function onDocumentTouchStart(event) {
			event.preventDefault();

			event.clientX = event.touches[0].clientX;
			event.clientY = event.touches[0].clientY;
			onDocumentMouseDown(event);
		}

		function onWindowResize() {
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();

			renderer.setSize(window.innerWidth, window.innerHeight);

		}


		function animate() {

		    requestAnimationFrame(animate);
		    controls.update();

			renderer.render(scene, camera);
			render();
		}

		function render() {
		    if (video && (video.readyState === video.HAVE_ENOUGH_DATA)) {
		        videoImageContext.drawImage(video, 0, 0);
		        if (videoTexture)
		            videoTexture.needsUpdate = true;
		    }

		    renderer.render(scene, camera);
		}

	</script>
</body>

</html>